<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>[copywiki destination=”copter,plane”] &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RPM Sensor Based Dynamic Notch Setup" href="common-rpm-based-notch.html" />
    <link rel="prev" title="Managing Gyro Noise with the Dynamic Harmonic Notch Filters" href="common-imu-notch-filtering.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="copter-introduction.html">Copter简介</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introducing Copter</a></li>
<li class="toctree-l2"><a class="reference internal" href="what-is-a-multicopter-and-how-does-it-work.html">How Multicopters Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="copter-use-case-overview.html">Use-Case Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="copter-flight-features.html">Flight Features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="common-geofencing-landing-page.html">[site wiki=”plane”]</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-geofencing-landing-page.html#geofencing">GeoFencing</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-geofencing-landing-page.html#detailed-information">Detailed Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-object-avoidance-landing-page.html">Object Avoidance</a></li>
<li class="toctree-l3"><a class="reference internal" href="terrain-following.html">Terrain Following (in Auto, Guided, etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="terrain-following-manual-modes.html">Surface Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="motor-thrust-scaling.html">Motor Thrust Scaling</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="common-imu-notch-filtering.html">Notch Filtering</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common-imu-notch-filtering.html#determining-notch-filter-center-frequency">Determining Notch Filter Center Frequency</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-imu-notch-filtering.html#notch-filter-control-types">Notch Filter Control Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-imu-notch-filtering.html#number-of-harmonics-filtered">Number of Harmonics Filtered</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-imu-notch-filtering.html#fft-dynamic-harmonic-notch-frequency-tracking">FFT Dynamic Harmonic Notch Frequency Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-imu-notch-filtering.html#checking-notch-filter-effectiveness">Checking Notch Filter Effectiveness</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="common-imu-notch-filtering.html#double-triple-notch">Double/Triple-Notch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="common-moving-vehicle-initialization.html">Moving Vehicle Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-non-gps-navigation-landing-page.html">Non-GPS Navigation</a></li>
<li class="toctree-l3"><a class="reference internal" href="weathervaning.html">Weathervaning and Wind Hold</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="choosing-a-frame.html">Choosing a MultiCopter Frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="what-you-need.html">Building Your Own Frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="safety-multicopter.html">MultiCopter Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference-frames.html">Reference Frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rtf.html">Ready to Fly vehicles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="copter-introduction.html">Copter Introduction</a></li>
          <li class="breadcrumb-item"><a href="copter-flight-features.html">Flight Features</a></li>
          <li class="breadcrumb-item"><a href="common-imu-notch-filtering.html">Managing Gyro Noise with the Dynamic Harmonic Notch Filters</a></li>
      <li class="breadcrumb-item active">[copywiki destination=”copter,plane”]</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="copywiki-destination-copter-plane">
<span id="common-throttle-based-notch"></span><h1>[copywiki destination=”copter,plane”]<a class="headerlink" href="#copywiki-destination-copter-plane" title="Permalink to this heading">¶</a></h1>
</section>
<section id="throttle-based-dynamic-notch-setup">
<h1>Throttle Based Dynamic Notch Setup<a class="headerlink" href="#throttle-based-dynamic-notch-setup" title="Permalink to this heading">¶</a></h1>
<p id="common-imu-notch-filtering-throttle-based-setup">If you do not have ESC telemetry or an RPM sensor, and are not using an autopilot capable of using the in-flight FFT mode, then throttle-based (<a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-mode" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_MODE</span></a> = 1 , or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-mode" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_MODE</span></a> = 1) center frequency control is best.</p>
<p>In order to configure the throttle-based dynamic harmonic notch filter it is important to identify  the motor noise at the hover throttle level. To do this we need to use the <a class="reference internal" href="common-imu-batchsampling.html#common-imu-batchsampling"><span class="std std-ref">batch sampler</span></a> to obtain logs for analysis.</p>
<p>Once this is done, the center frequency of the notch(s) can be set and other parameters configured:</p>
</section>
<section id="harmonic-notch-configuration-for-throttle-based-mode">
<h1>Harmonic Notch Configuration for Throttle Based Mode<a class="headerlink" href="#harmonic-notch-configuration-for-throttle-based-mode" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-mode" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_MODE</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-mode" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_MODE</span></a> = 1.</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-enable" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_ENABLE</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-enable" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_ENABLE</span></a> = 1 to enable the harmonic notch</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-ref" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_REF</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-ref" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_REF</span></a> = <em>hover_thrust</em> to set the harmonic notch reference value</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_FREQ</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_FREQ</span></a> = <em>hover_freq</em> to set the harmonic notch reference frequency</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-bw" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_BW</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-bw" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_BW</span></a> = <em>hover_freq</em> / 2 to set the harmonic notch bandwidth</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-fm-rat" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_FM_RAT</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-fm-rat" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_FM_RAT</span></a> to the percentage of <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_FREQ</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_FREQ</span></a> that you desire the notch frequency to track below hover throttle. Note that lower frequency notch filters will have more phase lag and can impact stability. If you want throttle based notch filtering to be effective at a throttle up to 30% below the configured notch frequency then set this parameter to 0.7. The default of 1.0 means the notch will not go below the frequency in the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_FREQ</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-freq" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_FREQ</span></a> parameter.</p></li>
</ul>
<p>Check the performance of the filter(s) after setup by doing another post filter configuration test flight as discussed in the <a class="reference internal" href="common-imu-batchsampling.html#common-imu-batchsampling"><span class="std std-ref">batch sampler</span></a> section and analyzing the logs.</p>
</section>
<section id="advanced-notch-frequency-scaling-adjustment-in-throttle-based-mode">
<h1>Advanced Notch Frequency Scaling Adjustment in Throttle Based Mode<a class="headerlink" href="#advanced-notch-frequency-scaling-adjustment-in-throttle-based-mode" title="Permalink to this heading">¶</a></h1>
<p>The harmonic notch is designed to match the motor noise frequency as it changes by interpreting the throttle value. The frequency is scaled up from the hover frequency and will never go below this frequency. However, in dynamic flight it is quite common to hit quite low motor frequencies during propwash. In order to address this it is possible to change the ref value in order to scale from a lower frequency.</p>
<ul class="simple">
<li><p>First perform a long dynamic flight using your current settings and post-filter batch logging. Examine the FFT and look at how far the motor noise peak extends below the hover frequency. Use this frequency - <em>min_freq</em> - as the lower bound of your scaling. Then in order to calculate an updated value of the throttle reference use:</p></li>
</ul>
<p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntch-ref" title="(in Rover)"><span class="xref std std-ref">INS_HNTCH_REF</span></a> and/or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ins-hntc2-ref" title="(in Rover)"><span class="xref std std-ref">INS_HNTC2_REF</span></a> = <em>hover_thrust</em> * SQUARE(<em>min_freq / hover_freq</em>)</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common-imu-notch-filtering.html" class="btn btn-neutral float-left" title="Managing Gyro Noise with the Dynamic Harmonic Notch Filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="common-rpm-based-notch.html" class="btn btn-neutral float-right" title="RPM Sensor Based Dynamic Notch Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>