<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FETtec OneWire ESCs &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FETtec OneWire ESCs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fettec-onewire-escs">
<span id="common-fettec-onewire"></span><h1>FETtec OneWire ESCs<a class="headerlink" href="#fettec-onewire-escs" title="Permalink to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is available on firmware revisions 4.1.1 and higher</p>
</div>
<img alt="../_images/FETtec_4in1_ESC.jpg" src="../_images/FETtec_4in1_ESC.jpg" />
<p>OneWire is an <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/master/libraries/AP_FETtecOneWire">ESC bi-directional communication protocol</a> from FETtec.</p>
<p>FETtec OneWire ESC’s telemetry information is sent back to the autopilot:</p>
<ul class="simple">
<li><p>Motor revolutions per minute (RPM)</p></li>
<li><p>Input voltage (V)</p></li>
<li><p>Current draw (A)</p></li>
<li><p>Power consumption (W)</p></li>
<li><p>Temperature (°C)</p></li>
<li><p>Summed CRC errors</p></li>
</ul>
<p>The autopilot uses it to:</p>
<ul class="simple">
<li><p>log the status of each ESC to the SDCard or internal Flash, for <a class="reference internal" href="common-logs.html#common-logs"><span class="std std-ref">post flight analysis</span></a></p></li>
<li><p>send the status of each ESC to the Ground Station or companion computer for <a class="reference external" href="https://ardupilot.org/planner/docs/mission-planner-telemetry-logs.html#mission-planner-telemetry-logs" title="(in Mission Planner)"><span class="xref std std-ref">real-time monitoring</span></a></p></li>
<li><p>optionally dynamically change the center frequency of the notch filters used to reduce frame vibration noise in the gyros. See optional configuration information below.</p></li>
<li><p>optionally measure battery voltage and power consumption. See optional configuration information below.</p></li>
</ul>
<section id="where-to-buy">
<h2>Where to buy<a class="headerlink" href="#where-to-buy" title="Permalink to this heading">¶</a></h2>
<p>Multiple OneWire supported ESCs are also available at <a class="reference external" href="https://fettec.net">FETtec</a></p>
</section>
<section id="connecting">
<h2>Connecting<a class="headerlink" href="#connecting" title="Permalink to this heading">¶</a></h2>
<p>The protocol supports up-to 24 ESCs, but ArduPilot’s device driver implementation currently limits this to 12.
Connect the <code class="docutils literal notranslate"><span class="pre">TLM</span></code> telemetry output from the ESC to the serial <code class="docutils literal notranslate"><span class="pre">RX</span></code> of your flight-controller.
The signal-pins <code class="docutils literal notranslate"><span class="pre">S1</span></code>, <code class="docutils literal notranslate"><span class="pre">S2</span></code>, <code class="docutils literal notranslate"><span class="pre">S3</span></code>, <code class="docutils literal notranslate"><span class="pre">S4</span></code> from the ESC are used to receive the commands from the flight-controller, so the serial <code class="docutils literal notranslate"><span class="pre">TX</span></code> from the flight-controller must be connected to
every signal-input in parallel. On CubeOrange the GPS2 port has been successfully tested and it is recommended that you use that serial port.</p>
</section>
<section id="configuring">
<h2>Configuring<a class="headerlink" href="#configuring" title="Permalink to this heading">¶</a></h2>
<section id="fettec-esc-configurator-software">
<h3>FETtec ESC configurator software<a class="headerlink" href="#fettec-esc-configurator-software" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/FETtec/ESC-Configurator/releases">FETtec ESC configurator</a> can change all ESC’s settings and do ESC firmware updates.
Use it to make sure, that your ESC Firmware Version is 2.17 (September 2021) or later.
Typically a FETtec autopilot can be used as a USB&lt;-&gt;OneWire bridge so that the <em>FETtec ESC configurator</em> can communicate with the ESCs.
ESC’s parameter changes and ESC firmware updates are also made via OneWire so a serial passthrough is possible.
Often used parameters are for example:</p>
<ul class="simple">
<li><p><strong>Motor direction</strong> - If your motor spins in the wrong direction you can change it easily without rewiring</p></li>
<li><p><strong>Motor beeps</strong> - Enables or disables motor beeps</p></li>
<li><p><strong>Soft brake</strong> - If you have props that “unscrew” if they are stopped too fast you can use the softbreak option.</p></li>
<li><p><strong>ESC IDs</strong> - The IDs of each ESC. These must start at 1, be unique and be contiguous.</p></li>
</ul>
</section>
<section id="ids-inside-the-escs">
<h3>IDs inside the ESCs<a class="headerlink" href="#ids-inside-the-escs" title="Permalink to this heading">¶</a></h3>
<p>Each ESC has it’s own ID, which can be configured by the FETtec ESC Configuration tool described above.
These IDs must start at ID 1 and increase without a gap (be in a single contiguous block).
Duplicate IDs are invalid.
If two or more 4in1 ESCs should be connected, the IDs of the second and third ESC have to be changed before they are connected, otherwise you will have duplicated IDs.</p>
<p>The function of the servo can be set like described below.</p>
<p>The following parameters have to be changed in MissionPlanner under <em>CONFIG</em> -&gt; <em>Full Parameter List</em> or with other Mavlink capable ground control station software.</p>
</section>
<section id="serial-connection-port">
<h3>Serial connection port<a class="headerlink" href="#serial-connection-port" title="Permalink to this heading">¶</a></h3>
<p>Set the SERIALx_PROTOCOL parameter to <code class="docutils literal notranslate"><span class="pre">FETtec_OneWire</span></code> (38) and SERIALx_OPTIONS parameter to <code class="docutils literal notranslate"><span class="pre">FullDuplex</span></code> (0), where x is the number of the serial port you are using.
Make sure the serial port you use has DMA activated</p>
<p>For example, a connection to SERIAL4 (recommended) port would need:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial4-protocol" title="(in Rover)"><span class="xref std std-ref">SERIAL4_PROTOCOL</span></a> = 38 (FETtec_OneWire)</p></li>
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial4-options" title="(in Rover)"><span class="xref std std-ref">SERIAL4_OPTIONS</span></a> = 0 (default, full duplex)</p></li>
</ul>
</section>
<section id="output-type">
<h3>Output type<a class="headerlink" href="#output-type" title="Permalink to this heading">¶</a></h3>
<p>This digital protocol can use the full 1000 to 2000 range. Do set these parameters as well:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#mot-pwm-max" title="(in Copter)"><span class="xref std std-ref">MOT_PWM_MAX</span></a> = 2000</p></li>
<li><p><a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#mot-pwm-min" title="(in Copter)"><span class="xref std std-ref">MOT_PWM_MIN</span></a> = 1000</p></li>
</ul>
</section>
<section id="functions-to-output">
<h3>Functions to output<a class="headerlink" href="#functions-to-output" title="Permalink to this heading">¶</a></h3>
<p>Change SERVOx_FUNCTION parameters according to the number of motors and their order. e.g. for a quadcopter:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo1-function" title="(in Rover)"><span class="xref std std-ref">SERVO1_FUNCTION</span></a> = 33</p></li>
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo2-function" title="(in Rover)"><span class="xref std std-ref">SERVO2_FUNCTION</span></a> = 34</p></li>
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo3-function" title="(in Rover)"><span class="xref std std-ref">SERVO3_FUNCTION</span></a> = 35</p></li>
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo4-function" title="(in Rover)"><span class="xref std std-ref">SERVO4_FUNCTION</span></a> = 36</p></li>
</ul>
</section>
<section id="ftw-mask">
<h3>FTW Mask<a class="headerlink" href="#ftw-mask" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> parameter selects which servo outputs, if any, will be routed to FETtec ESCs.
You need to reboot after changing this parameter.
Only SERVO1_FUNCTION to SERVO12_FUNCTION can be routed using the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a>.
You do not need to change the FETtec IDs inside the ESCs if you change the servo output assignments inside ArduPilot the using the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> parameter.</p>
<p>After that you must set the servo output channels you want to use in the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> parameter, and again restart your autopilot. For example, a quadcopter using the first four motors would need the first four bits of the bitmask set:</p>
<p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> = 15</p>
<p>Each bit of the mask describes whether a motor is attached and should be used with oneWire. The value is configured decimal and is the sum of the decimal equivalent of each set bit. Bit 1 corresponds to 2^1 = 1, Bit 2 corresponds to 2^2 = 2,… . E.g. if you have connected Motor 1,2,3,4 the mask is 1+2+4+8 = 15.</p>
<p>Simply sum the decimal values for the motors connected or read it from the list below.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Motor Count</p></td>
<td><p>Mask</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>31</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>63</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>127</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>255</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>511</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>1023</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>2047</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>4095</p></td>
</tr>
</tbody>
</table>
</section>
<section id="reverse-motor-direction-mask">
<h3>Reverse motor direction mask<a class="headerlink" href="#reverse-motor-direction-mask" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-rvmask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_RVMASK</span></a> parameter selects which outputs, if any, will reverse their rotation.
This parameter effects the outputs immediately when changed and the motors are not armed.
This parameter is only visible if the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> parameter has at least one bit set.</p>
<p>To leave to motors with their default rotation direction do:</p>
<p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-rvmask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_RVMASK</span></a> = 0</p>
<p>Each bit of the mask describes whether a motor is rotation direction should be reversed.
The value is configured decimal and is the sum of the decimal equivalent of each set bit.
Bit 0 (first ESC) corresponds to 2^0 = 1, Bit 1 (second ESC) corresponds to 2^1 = 2, … .</p>
</section>
<section id="number-of-motor-electrical-poles">
<h3>Number of motor electrical poles<a class="headerlink" href="#number-of-motor-electrical-poles" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-poles" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_POLES</span></a> parameter selects Number of motor electrical poles.
It is used to calculate the motors RPM
This parameter effects the RPM calculation immediately when changed.
This parameter is only visible if the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> parameter has at least one bit set.</p>
</section>
</section>
<section id="optional-features">
<h2>Optional features<a class="headerlink" href="#optional-features" title="Permalink to this heading">¶</a></h2>
<p>Optional features can be configured using the instructions at their respective wiki page:</p>
<ul class="simple">
<li><p>dynamically change the center frequency of the <a class="reference internal" href="common-esc-telem-based-notch.html#esc-telemetry-based-dynamic-notch-filter"><span class="std std-ref">notch filters used to reduce frame vibration noise in the gyros</span></a></p></li>
<li><p>measure <a class="reference internal" href="common-esc-telemetry.html#esc-telemetry-based-battery-monitor"><span class="std std-ref">battery voltage, current and power consumption</span></a></p></li>
</ul>
</section>
<section id="sitl-simulation">
<h2>SITL simulation<a class="headerlink" href="#sitl-simulation" title="Permalink to this heading">¶</a></h2>
<p>The ESCs can be simulated in SITL by adding <code class="docutils literal notranslate"><span class="pre">--uartF=sim:fetteconewireesc</span></code> to the SITL command line and setting the following additional parameters:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial5-protocol" title="(in Rover)"><span class="xref std std-ref">SERIAL5_PROTOCOL</span></a> = 38</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SIM_FTOWESC_ENA</span></code> = 1</p></li>
</ul>
<p>This assumes you use SERIAL5 for simulation.
If you want to use another one you need to adjust both the SITL command line argument and the <cite>SERIAL*_PROTOCOL</cite> parameter.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>ESCs keep initializing</dt><dd><p>If the flight-control is not receiving telemetry signals from every ESC, and it is unarmed it reinitializes the ESCs until every ESC is configured correctly.
The FTW mask is used to determine the motor count that must be found. Double check if the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#servo-ftw-mask" title="(in Rover)"><span class="xref std std-ref">SERVO_FTW_MASK</span></a> is calculated correctly to fit the actual motor count.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The ESCs are not initializing.</dt><dd><p>Check if the parameters are correct. Also make sure the telemetry pin is connected, as it will not work without it.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ESCs are not found in FETtec configurator.</dt><dd><p>A halfduplex 2MBaud/s serial connection is required for the use with the FETtec configurator, which is currently not supported by ArduPilot. You need to use a external serial  device like a FETtec FC or a USB serial adapter. Please disconnect the ArduPilot FC from the ESCs to find it in the FETtec configurator.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>