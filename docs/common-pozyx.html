<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pozyx for Non-GPS Navigation &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pozyx for Non-GPS Navigation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pozyx-for-non-gps-navigation">
<span id="common-pozyx"></span><h1>Pozyx for Non-GPS Navigation<a class="headerlink" href="#pozyx-for-non-gps-navigation" title="Permalink to this heading">¶</a></h1>
<p>[copywiki destination=”copter,rover,blimp”]</p>
<p>This article explains how a <a class="reference external" href="https://www.pozyx.io/">Pozyx</a> system based on the <a class="reference external" href="http://www.decawave.com/products/dwm1000-module">DWM1000</a> can be used as a short-range substitute for a GPS allowing position control modes like Loiter, PosHold, RTL, Auto indoors.</p>
<div class="video_wrapper" style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/ozr8tGO9CFs" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div><section id="required-hardware">
<h2>Required Hardware<a class="headerlink" href="#required-hardware" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>4 <a class="reference external" href="https://www.pozyx.io/store/detail/5">Pozyx anchors</a> and 1 <a class="reference external" href="https://www.pozyx.io/store/detail/4">Pozyx tag</a>.  Note the <a class="reference external" href="https://www.pozyx.io/store/detail/2">Ready to Localize</a> or <a class="reference external" href="https://www.pozyx.io/store/detail/3">Developer Kits</a> are more economical than buying individual tags and anchors.</p></li>
<li><p>one <a class="reference external" href="https://www.arduino.cc/en/Main/ArduinoBoardUno">Arduino Uno R2 or R3</a></p></li>
<li><p>4 <a class="reference external" href="https://www.amazon.com/s/ref=nb_sb_noss_2?url=search-alias%3Daps&amp;field-keywords=portable+charger&amp;rh=i%3Aaps%2Ck%3Aportable+charger">portable chargers</a> with type A USB ports to power the anchors (optional)</p></li>
<li><p>4 <a class="reference external" href="https://www.amazon.com/s/ref=nb_sb_noss_1?url=search-alias%3Daps&amp;field-keywords=tripod&amp;rh=i%3Aaps%2Ck%3Atripod">tripods</a> to mount the anchors (optional)</p></li>
</ul>
</section>
<section id="placing-the-anchors">
<h2>Placing the anchors<a class="headerlink" href="#placing-the-anchors" title="Permalink to this heading">¶</a></h2>
<p>The anchors should be placed in a rectangular shape.  The anchor with the lowest ID (IDs are printed in hexidecimal on each device) will act as the “origin” and should be placed at the lower-left corner of the rectangle.  Each of the remaining three anchors should be placed in a corner so that the anchor IDs increase as you travel an “N” pattern within the rectangle.  The configuration is slightly simpler if the line from the origin anchor to the 2nd anchor is due North but it is not required as the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-orient-yaw" title="(in Rover)"><span class="xref std std-ref">BCN_ORIENT_YAW</span></a> parameter can be used to account this difference.</p>
<a class="reference external image-reference" href="../_images/pozyx-anchor-layout.png"><img alt="../_images/pozyx-anchor-layout.png" src="../_images/pozyx-anchor-layout.png" /></a>
</section>
<section id="preparing-the-tag">
<h2>Preparing the tag<a class="headerlink" href="#preparing-the-tag" title="Permalink to this heading">¶</a></h2>
<a class="reference external image-reference" href="../_images/pozy-pixhawk-uno.png"><img alt="../_images/pozy-pixhawk-uno.png" src="../_images/pozy-pixhawk-uno.png" /></a>
<ul class="simple">
<li><p>connect one of the Pixhawk’s telemetry connections to the UNO.  Telem1 is shown above but Telem2 or Serial4/5 will work equally well.</p></li>
<li><p>Pixhawk’s GND should be connecdted to one of the UNO’s GND pins.</p></li>
<li><p>Pixhawk’s TX should be connected to the UNO’s pin 10.</p></li>
<li><p>Pixhawk’s RX should be connected to the UNO’s pin 11.</p></li>
<li><p>Pixhawk’s VCC may be connected to the UNO’s 5V connector to provide power to the Uno/Pozyx from the Pixhawk.</p></li>
</ul>
<p>The Arduino IDE should be used to load <a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/Tools/Pozyx/IndoorLoiter/IndoorLoiter.ino">IndoorLoiter sketch</a> onto the Uno after first changing the anchor tags <a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/Tools/Pozyx/IndoorLoiter/IndoorLoiter.ino#L12">found here</a> to match the IDs of the tags in your setup.</p>
<p>At this point you may wish to test the tag’s ability to communicate with the tags by:</p>
<ul class="simple">
<li><p>powering on all the anchors.</p></li>
<li><p>connect the UNO’s Type B USB to your PC.</p></li>
<li><p>connect with the Arduino IDE’s serial monitor (set to baud 115200) and check no “Beacon Configuration failed” messages appear.  If they do, check that the IDs have been set correctly in the IndoorLoiter2.ino sketch (above).</p></li>
</ul>
<p>Mount the Pozyx tag on the top of the Arduino Uno and then mount on the vehicle.</p>
</section>
<section id="configuration-through-the-ground-station">
<h2>Configuration through the Ground Station<a class="headerlink" href="#configuration-through-the-ground-station" title="Permalink to this heading">¶</a></h2>
<p>Connect with a Ground Station and set the following parameters:</p>
<ul class="simple">
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-type" title="(in Rover)"><span class="xref std std-ref">BCN_TYPE</span></a> to 1 (means using Pozyx system)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-latitude" title="(in Rover)"><span class="xref std std-ref">BCN_LATITUDE</span></a>, <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-longitude" title="(in Rover)"><span class="xref std std-ref">BCN_LONGITUDE</span></a> and <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-alt" title="(in Rover)"><span class="xref std std-ref">BCN_ALT</span></a> to match your actual location.  Getting these values exactly correct is not particularly important although getting it close is required in order for the compass’s declination to be correctly looked up from the small database held within ArduPilot.</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-orient-yaw" title="(in Rover)"><span class="xref std std-ref">BCN_ORIENT_YAW</span></a> to the heading from the origin anchor to the 2nd anchor.  One way to capture this value is to stand at the origin holding the vehicle so that its nose points towards the second beacon.  Read the vehicle’s heading from the HUD and enter this value into <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#bcn-orient-yaw" title="(in Rover)"><span class="xref std std-ref">BCN_ORIENT_YAW</span></a></p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ek3-src1-posxy" title="(in Rover)"><span class="xref std std-ref">EK3_SRC1_POSXY</span></a> to 4 (Beacon)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ek3-src1-velxy" title="(in Rover)"><span class="xref std std-ref">EK3_SRC1_VELXY</span></a> to 0 (None)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ek3-src1-velz" title="(in Rover)"><span class="xref std std-ref">EK3_SRC1_VELZ</span></a> to 0 (None)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#arming-check" title="(in Rover)"><span class="xref std std-ref">ARMING_CHECK</span></a> to -9 to disable the GPS arming check</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial1-baud" title="(in Rover)"><span class="xref std std-ref">SERIAL1_BAUD</span></a> to 115 to set telemetry1’s baud rate to 115200 (if using Telem2 set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial2-baud" title="(in Rover)"><span class="xref std std-ref">SERIAL2_BAUD</span></a> instead)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial1-protocol" title="(in Rover)"><span class="xref std std-ref">SERIAL1_PROTOCOL</span></a> to 13 (Beacon) to enable reading the IndoorLoiter2 protocol (If using Telem2 set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial2-protocol" title="(in Rover)"><span class="xref std std-ref">SERIAL2_PROTOCOL</span></a> instead)</p></li>
<li><p>set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#brd-ser1-rtscts" title="(in Rover)"><span class="xref std std-ref">BRD_SER1_RTSCTS</span></a> to 0 to ensure telem1 does not use flow control (If using Telem2 set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#brd-ser2-rtscts" title="(in Rover)"><span class="xref std std-ref">BRD_SER2_RTSCTS</span></a> instead, not required if using Serial4/5)</p></li>
</ul>
</section>
<section id="ground-testing">
<h2>Ground Testing<a class="headerlink" href="#ground-testing" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Connect the Autopilot to a ground station.  You may need to connect the Lipo battery as well because some computers are unable to provide enough power through their USB port for the combined Pixhawk+Pozyx+Uno.</p></li>
<li><p>Press the UNO’s white or red reset button which can be found next to the USB port (see image above)</p></li>
<li><p>After about 1 minute the vehicle’s position should jump to the lattitude, longitude you input during the configuration step (above).  If it does not, connect a USB cable to the UNO’s USB port and open the Arduino IDE’s serial monitor and look for errors.</p></li>
<li><p>Check that the vehicle’s position is relatively stable (i.e. moving around less than one meter)</p></li>
<li><p>Walk the vehicle around between the anchors and ensure that its position on the map updates correctly</p></li>
</ul>
</section>
<section id="flight-testing">
<h2>Flight testing<a class="headerlink" href="#flight-testing" title="Permalink to this heading">¶</a></h2>
<p>Setup the transmitter with Stabilize, AltHold and Loiter flight modes.
Take off in AltHold mode and maintain a stable hover.
Switch to Loiter but be ready to switch back to AltHold or Stabilize if the vehicle’s position or altitude becomes unstable.</p>
</section>
<section id="dataflash-logging">
<h2>DataFlash logging<a class="headerlink" href="#dataflash-logging" title="Permalink to this heading">¶</a></h2>
<p>The distance to the beacons can be found in the dataflash log’s BCN message’s D0, D1, D2, D3 fields.</p>
</section>
<section id="user-videos">
<h2>User videos<a class="headerlink" href="#user-videos" title="Permalink to this heading">¶</a></h2>
<div class="video_wrapper" style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/mVLj2kUZXe0" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>