<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenMV for Optical Flow &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">OpenMV for Optical Flow</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="openmv-for-optical-flow">
<span id="common-openmv-optflow"></span><h1>OpenMV for Optical Flow<a class="headerlink" href="#openmv-for-optical-flow" title="Permalink to this heading">¶</a></h1>
<p>[copywiki destination=”copter,plane,rover”]</p>
<p>The <a class="reference external" href="https://openmv.io/">OpenMV camera</a> is a programmable camera which includes support for optical flow.</p>
<div class="video_wrapper" style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/BmixVDBiIbA" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div><section id="where-to-buy">
<h2>Where to Buy<a class="headerlink" href="#where-to-buy" title="Permalink to this heading">¶</a></h2>
<p>The sensor can be purchased directly from <a class="reference external" href="https://openmv.io/collections/cams">openmv.io</a></p>
</section>
<section id="connection-to-autopilot">
<h2>Connection to Autopilot<a class="headerlink" href="#connection-to-autopilot" title="Permalink to this heading">¶</a></h2>
<a class="reference external image-reference" href="../_images/openmv-pixhawk.jpg"><img alt="../_images/openmv-pixhawk.jpg" src="../_images/openmv-pixhawk.jpg" style="width: 450px;" /></a>
<ul class="simple">
<li><p>The camera should be mounted on the underside of the copter with the camera lens pointing downwards.  The camera edge with the lens should be towards the front of the vehicle.  The image above is incorrect because the autopilot’s arrow is pointing down while the sensor’s lens is close to the top</p></li>
<li><p>Connect the camera’s P4, VIN and GND pins to one of the autopilot’s serial ports as shown above.  In the image above the sensor is connected to a Pixhawk’s Telem2 port</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#flow-type" title="(in Rover)"><span class="xref std std-ref">FLOW_TYPE</span></a> = 5 (MAVLink)</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial2-protocol" title="(in Rover)"><span class="xref std std-ref">SERIAL2_PROTOCOL</span></a> = 1 (MAVLink) if using Serial2/Telem2, if connected to another serial port use the corresponding SERIALx_PROTOCOL parameter</p></li>
<li><p>Set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#serial2-baud" title="(in Rover)"><span class="xref std std-ref">SERIAL2_BAUD</span></a> = 115</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Official pinout for the camera can be found <a class="reference external" href="https://cdn.shopify.com/s/files/1/0803/9211/files/cam-v3-pinout.png?6147773140464094715">here</a></p>
</div>
</section>
<section id="camera-setup">
<h2>Camera Setup<a class="headerlink" href="#camera-setup" title="Permalink to this heading">¶</a></h2>
<p>Official setup information can be found <a class="reference external" href="http://docs.openmv.io/openmvcam/tutorial/index.html">here</a> but the short form is:</p>
<ul class="simple">
<li><p>Connect the OpenMV camera to your computer.  On Windows the camera should appear as a new COM port and a virtual drive should also be created (this is where scripts are copied to below)</p></li>
<li><p><a class="reference external" href="https://openmv.io/pages/download/">Download, install and run the OpenMV IDE</a></p></li>
<li><p>Select File, Examples, 18-MAVLink, mavlink_opticalflow.py</p></li>
<li><p>On the bottom right, select the Drive that corresponds to the OpenMV camera’s virtual drive</p></li>
<li><p>Select Tools, save open script to OpenMV Cam</p></li>
<li><p>Select Tools, Reset OpenMV Cam</p></li>
<li><p>A green light on the camera should begin flashing which shows the script is running</p></li>
</ul>
<a class="reference external image-reference" href="../_images/openmv-ide.jpg"><img alt="../_images/openmv-ide.jpg" src="../_images/openmv-ide.jpg" style="width: 450px;" /></a>
</section>
<section id="additional-notes">
<h2>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>As with the <a class="reference internal" href="common-px4flow-overview.html#common-px4flow-overview"><span class="std std-ref">PX4Flow sensor</span></a> a range finder is required to use the sensor for autonomous modes including <a class="reference internal" href="loiter-mode.html#loiter-mode"><span class="std std-ref">Loiter</span></a> and <a class="reference internal" href="rtl-mode.html#rtl-mode"><span class="std std-ref">RTL</span></a></p></li>
<li><p><a class="reference internal" href="flowhold-mode.html#flowhold-mode"><span class="std std-ref">FlowHold</span></a> does not require the use of a rangefinder</p></li>
<li><p>The sensor has been successfully tested to altitudes of about 10m</p></li>
<li><p>Performance can be improved by setting the <a class="reference internal" href="common-sensor-offset-compensation.html#common-sensor-offset-compensation"><span class="std std-ref">sensors position parameters</span></a>.  For example if the sensor is mounted 2cm forward and 5cm below the frame’s center of rotation set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#flow-pos-x" title="(in Rover)"><span class="xref std std-ref">FLOW_POS_X</span></a> to 0.02 and <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#flow-pos-z" title="(in Rover)"><span class="xref std std-ref">FLOW_POS_Z</span></a> to 0.05.</p></li>
</ul>
</section>
<section id="testing-and-setup">
<h2>Testing and Setup<a class="headerlink" href="#testing-and-setup" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>See <a class="reference external" href="https://ardupilot.org/rover/docs/common-optical-flow-sensor-setup.html#common-optical-flow-sensor-setup" title="(in Rover)"><span>Optical Flow Sensor Testing and Setup</span></a> for setup guides.</p></li>
<li><p>Note that recommended value for <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ek2-flow-delay" title="(in Rover)"><span class="xref std std-ref">EK2_FLOW_DELAY</span></a> or <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#ek3-flow-delay" title="(in Rover)"><span class="xref std std-ref">EK3_FLOW_DELAY</span></a> for this sensor is 80.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>