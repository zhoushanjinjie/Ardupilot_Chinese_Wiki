<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Archived:Using Xbee radios for telemetry with APM &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Archived:Using Xbee radios for telemetry with APM</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="archived-using-xbee-radios-for-telemetry-with-apm">
<span id="xbee-radios"></span><h1>Archived:Using Xbee radios for telemetry with APM<a class="headerlink" href="#archived-using-xbee-radios-for-telemetry-with-apm" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>ARCHIVED ARTICLE</strong></p>
<p>The correct topic to use is
<a class="reference internal" href="common-telemetry-xbee.html#common-telemetry-xbee"><span class="std std-ref">Telemetry-XBee</span></a></p>
</div>
<a class="reference external image-reference" href="../_images/KT-Telemetry-Xbee-2new.jpg"><img alt="../_images/KT-Telemetry-Xbee-2new.jpg" src="../_images/KT-Telemetry-Xbee-2new.jpg" /></a>
<section id="hooking-up-your-xbee-wireless-modules">
<h2>Hooking up your Xbee wireless modules<a class="headerlink" href="#hooking-up-your-xbee-wireless-modules" title="Permalink to this heading">¶</a></h2>
<p>Adding wireless telemetry is not difficult and can extend the
capabilities of your UAV immensely. We recommend
<a class="reference external" href="https://www.sparkfun.com/categories/222.html">900Mhz Xbees</a>. If you are in
Europe, where 900Mhz is not allowed, you can use a 2.4Ghz Xbee kit instead.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>On APM 2, you cannot use the Xbee while your APM board is
connected to the USB port.</p>
<p>That’s because the Xbee and USB share the same serial port, with some clever multiplexing to detect if the USB cable is plugged in and switching output to the USB if so.
Although that has the huge win of freeing up a serial port for some other use (e.g.
connect an Android phone),
it does mean that you need to disconnect the board from the USB cable and power it some other way when testing wireless telemetry on your bench.</p>
</div>
</section>
<section id="wiring-it-up">
<h2>Wiring it up<a class="headerlink" href="#wiring-it-up" title="Permalink to this heading">¶</a></h2>
<section id="apm-2-0">
<h3>APM 2.0<a class="headerlink" href="#apm-2-0" title="Permalink to this heading">¶</a></h3>
<a class="reference external image-reference" href="../_images/telemtry.jpg"><img alt="../_images/telemtry.jpg" src="../_images/telemtry.jpg" /></a>
<a class="reference external image-reference" href="../_images/xbee_amp2_connection.jpg"><img alt="../_images/xbee_amp2_connection.jpg" src="../_images/xbee_amp2_connection.jpg" /></a>
<p>Connect the XtremeBee adapter (with the Xbee plugged in) to APM 2 as
shown above. Your adapter should be in “Master” mode. (“Master” and
“Slave” just reverse the TX and RX pins).</p>
<p>We recommend the 3DR four-wire Xbee cable, which comes with the official
Wireless Telemetry kit shown above. It is designed to connect the
XtreamBee adapter to APM, as it will provide the neatest and safest
connection.</p>
</section>
<section id="apm-2-5">
<h3>APM 2.5<a class="headerlink" href="#apm-2-5" title="Permalink to this heading">¶</a></h3>
<p>On APM 2.5, use the dedicated telemetry port and supplied cable, as
shown:</p>
<a class="reference external image-reference" href="../_images/xbee_amp2.5_telemetry_port_connection.jpg"><img alt="../_images/xbee_amp2.5_telemetry_port_connection.jpg" src="../_images/xbee_amp2.5_telemetry_port_connection.jpg" /></a>
</section>
</section>
<section id="on-the-ground-side">
<h2>On the ground side<a class="headerlink" href="#on-the-ground-side" title="Permalink to this heading">¶</a></h2>
<p>If you’re using a USB adapter, simply connect it via a USB cable as shown:</p>
<a class="reference external image-reference" href="../_images/xbee_usb_connection.jpg"><img alt="../_images/xbee_usb_connection.jpg" src="../_images/xbee_usb_connection.jpg" /></a>
<p>If you’re using an XtreamBee adapter on the ground side, connect it to a
FTDI cable as shown below and plug that into your USB port. The adapter
should also be in Master mode.</p>
<figure class="align-default" id="id1">
<a class="reference external image-reference" href="../_images/XtreemBee.jpg"><img alt="../_images/XtreemBee.jpg" src="../_images/XtreemBee.jpg" /></a>
<figcaption>
<p><span class="caption-text">XBee with XtreemBee Adapter</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Now you’re done! Remember to select the right Xbee port (you can see
which one has been assigned to the Xbee in the Windows Control Panel
device manager) and a baud rate of 57k in the Mission Planner or other
GCS when you’re connecting.</p>
<a class="reference external image-reference" href="../_images/xbeebaud.png"><img alt="../_images/xbeebaud.png" src="../_images/xbeebaud.png" /></a>
<section id="optional-changing-your-telemetry-to-use-uart2-aka-serial3">
<h3>(Optional) Changing your telemetry to use UART2 (aka Serial3)<a class="headerlink" href="#optional-changing-your-telemetry-to-use-uart2-aka-serial3" title="Permalink to this heading">¶</a></h3>
<p>By default an Xbee connected to the APM2 will use UART0 (aka “Serial” in
Arduino) which is shared with the USB as mentioned above. If you wish to
instead use UART2 (aka “Serial3”) for telemetry you can change the
“AutoMUX UART0” jumper on the bottom of the APM2.</p>
<p>Although difficult to see, by default there are two small jumpers
between the upper pads that must be cut with an X-Acto blade. Then a new
solder bridge must be made to join the bottom pads.</p>
<a class="reference external image-reference" href="../_images/BOTTOM_AutoMUX_UART02_small.jpg"><img alt="../_images/BOTTOM_AutoMUX_UART02_small.jpg" src="../_images/BOTTOM_AutoMUX_UART02_small.jpg" /></a>
</section>
<section id="optional-rolling-your-own-xbee-telemetry-setup">
<h3>(Optional) Rolling your own Xbee telemetry setup<a class="headerlink" href="#optional-rolling-your-own-xbee-telemetry-setup" title="Permalink to this heading">¶</a></h3>
<p>You can make your own telemetry kit if you’d like. The first thing to
keep in mind is that you should use Xbee modules in a different
frequency range than your RC equipment.</p>
<p>In general, we recommend 900Mhz Xbee modules, but in some countries
900Mhz is not approved. In those cases you can use 2.4Ghz Xbee modules.
In that configuration, we use <em>Xbee Pro wireless modules</em></p>
<p>Setup can be a little tricky, so please see the comments below in this
manual to see how other people have done it. In particular, we do not
recommend the DIY Drones XtreamBee adapter for those modules. Instead,
try the</p>
<p><a class="reference external" href="https://www.sparkfun.com/categories/111">Sparkfun</a> adapters. Please
note that the DIY Drones team will only support the recommended 900Mhz
Xbee modules, so if you use something else please turn the community for
help, not the DIY Drones developers.</p>
<p><a class="reference external" href="https://diydrones.com/profiles/blogs/some-tips-on-picking-frequencies">Here is more discussion</a>
on how to pick the best frequencies for your setup.</p>
<p>All Xbee modules need adapters to work with APM. You have two choices:</p>
<ul class="simple">
<li><p>A DIY Drones XtreamBee adapters on the aircraft side, and a <em>USB
adapter board</em> on the ground/laptop side with a USB cable.</p></li>
<li><p>If you already have an FTDI cable, get two DIY Drones XtreamBee
adapters.</p></li>
</ul>
</section>
</section>
<section id="setting-up-the-xbee-modules">
<h2>Setting up the Xbee modules<a class="headerlink" href="#setting-up-the-xbee-modules" title="Permalink to this heading">¶</a></h2>
<p>If you have the DIY Drones Telemetry Kit, your Xbee modules are already
set up and ready to go. But if you’re setting up your own, here are some
instructions:</p>
<p>The Xbee modules ship with a default of 9600bps, which you must change
to match the APM’s serial speed of 57600 bps; set your Xbee modules to
match this speed. (If you want to use a different speed, you can change
that by entering the following line in the APM_Config.h file: <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">:ref:`SERIAL3_BAUD&lt;SERIAL3_BAUD&gt;`</span> <span class="pre">[whatever</span> <span class="pre">baud</span> <span class="pre">rate</span> <span class="pre">you</span> <span class="pre">want]</span></code>)</p>
<p>Connect each one of the them to the USB adapter board, plug the USB
cable into your PC, and use Digi’s X-CTU utility (Mac/Linux users see
section below on an alternative utility from motosenso) to select the
right serial port and communicate with them. Remember to initially set
the utility to 9600bps to contact the new Xbee modules, and than after
you’ve changed the speed, change the utility’s serial speed accordingly.
You should also give the modules unique Network IDs (VIDs) so they will
be paired. Just use any 3-digit number, and just make sure you have set
it the same on both modules. (Note: If you will be flying near other UAV
planes make sure to verify the Network IDs are unique and not used by
others in your vicinity.)</p>
<p>This is what the setting should look like when you click “Read” in Modem
Configuration tab of X-CTU (we’re using 999 as the VID here as an
example, and I’ve highlighted the correct baud rate):</p>
<a class="reference external image-reference" href="../_images/Xbeescreenshot.png"><img alt="../_images/Xbeescreenshot.png" src="../_images/Xbeescreenshot.png" /></a>
<p>Note: If you bought your Xbee modules from Sparkfun, rather than the
official DIY Drones kit, please note that they sometimes ship with the
wrong firmware. X-CTU may try to download new code, which will probably
fail (cancel it). If your Xbee module is reporting that it’s an XBP09-DM
(rather than the correct XBP09-DP), do the following:</p>
<ol class="arabic simple">
<li><p>If you have the XBP09-DP modules, you must download XBP09-DP
firmware. If you have downloaded XBP09-DM firmware, it will kind-of
work, but will fail at the PID-config screen.</p></li>
<li><p>X-CTU will report the module as XBP09-DM. Ignore that. Go to the
Modem Configuration tab and do the following:</p>
<ol class="arabic simple">
<li><p>Select Modem as XBP09-DP, Function Set XBEE-PRO 900, Version 1002.
It is important that you select 1002. Version 1061 does not work
at first.</p></li>
<li><p>Click the Show Defaults button under the Parameter View.</p></li>
<li><p>Click the Write button under “Modem Parameters and Firmware”.</p></li>
<li><p>Go back to PC Settings, change Baud to 9600. Click Query. It will
show XBP09-DM. Ignore that.</p></li>
<li><p>Go back to Modem Configuration. Click Read. It should show
XBP09-DP as the modem. Version 1002.</p></li>
<li><p>Now select Version 1061.</p></li>
<li><p>Click “Show Defaults”</p></li>
<li><p>Click on the DD parameter and set it to 0. This step is important,
otherwise the 1161 firmware download will fail.</p></li>
<li><p>Click “Write”. Now your firmware is XBP09-DP Version 1161.</p></li>
</ol>
</li>
<li><p>Now change the baud rate and Modem VID, redownload and you should be
good to go.</p></li>
</ol>
<p>It will still show XBP09-DM in the PC Settings Query. Don’t worry about
that.</p>
</section>
<section id="for-non-pc-users">
<h2>For Non-PC users<a class="headerlink" href="#for-non-pc-users" title="Permalink to this heading">¶</a></h2>
<p>MacOS, Linux or Windows users - there is a free cross-platform
alternative to X-CTU, called moltosenso Network Manager.
Download the software
<a class="reference external" href="https://www.moltosenso.com/client/fe/browser.php?pc=/client/fe/download.php">here</a>.
The moltosenso Team collaborated with us writing a
<a class="reference external" href="https://forum.moltosenso.com/viewtopic.php?f=16&amp;t=8#p9">special tutorial</a>
on the setup of Xbee radios for ArduPilot and Copter Telemetry using
their software. Enjoy!</p>
</section>
<section id="testing-the-connection">
<h2>Testing the connection<a class="headerlink" href="#testing-the-connection" title="Permalink to this heading">¶</a></h2>
<p>If you open up a terminal program on your laptop (you can use the
Arduino IDE’s serial monitor for this, too), select the correct serial
port, and set the baud rate to whatever you set the Xbee modules to
above (the default is 57600). Once you do this, you should see APM
telemetry coming in. Anytime there is a “Serial3.println” in the code,
that data will be sent through the Xbees to the ground. You can record
any data you want, and even datalog from the ground! You can also open
the Ground Station software, setting the right port and baud speed) and
it should begin to show APM data.</p>
<p>Additionally, if you want to test the range of your Xbee link, connect
the plane-side Xbee module’s RX and TX pins together to create a
loopback circuit and use the X-CTU utility’s range test function. For
the modules we are using you should get around a mile.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’ve got an Xbee attached to your APM, the USB cable will
probably not provide enough power by itself to drive them both. Please
also have an ESC and LiPo connected to the RC pins to provide additional
power. (You can tell that you’ve got a low power (“brownout”) condition
if you just have the red C LED blinking dimly, or the APM board is
otherwise intermittent.)</p>
</div>
</section>
<section id="test-code">
<h2>Test code<a class="headerlink" href="#test-code" title="Permalink to this heading">¶</a></h2>
<p>ArduPilot Mega has four serial ports so all the usual Arduino serial
commands now take a specifier to say which port you want to read from or
write to. For example: <code class="docutils literal notranslate"><span class="pre">Serial1.print()</span></code>, <code class="docutils literal notranslate"><span class="pre">Serial2.print()</span></code>. The port
connected to the USB/FDTI connector is Serial0. The port connected to
the Telecom pins is Serial3.</p>
<ol class="arabic">
<li><p>Plug your Xbee into one USB port and your APM into another. Use Arduino
to load the demo code, and then in the Arduino IDE set the serial port
to the one assigned to your APM board. Then open the serial monitor,
setting the baud rate to 115200. You should see “Port 0” repeated as
follows, showing the output from the APM’s USB port:</p>
<a class="reference external image-reference" href="../_images/xbeetest2.png"><img alt="../_images/xbeetest2.png" src="../_images/xbeetest2.png" /></a>
</li>
<li><p>Now switch the serial port to the one your Xbee is assigned to and
reopen the serial monitor, setting the baud rate to 57600 (which is the
speed your Xbees should already be programmed for). You should now see
“Port 3” repeated, showing the output from APM’s Xbee port.</p></li>
</ol>
</section>
<section id="unbricking-an-xbee">
<h2>Unbricking an Xbee<a class="headerlink" href="#unbricking-an-xbee" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes Xbee modules get corrupted due to spurious
signals. If you’re finding that yours stops working (green LED on
Adafruit adapter doesn’t come on), instructions to reload the firmware
follow:</p>
</div>
<p>Using the USB adapter board:</p>
<ol class="arabic simple">
<li><p>Take the module out of the interface board.</p></li>
<li><p>Connect the interface board to the computer.</p></li>
<li><p>Open X-CTU make sure Baud Rate is set to 9600</p></li>
<li><p>Go to “Modem Configuration”</p></li>
<li><p>Put a check in the “Always update firmware” box</p></li>
<li><p>Select proper modem from drop down menu (for the 900Mhz ones
recommended above select “XBP09-DP”; for 2.4GHZ Xeebee Pro 2 select
“XBP24-B”)</p></li>
<li><p>Click on the “Write” button. After a few seconds of trying to read
the modem, you will get an Info box that says Action Needed. At this
point, CAREFULLY insert the module into the interface board. After a
few seconds, this should trigger a reloading of the firmware.</p></li>
<li><p>You may get the info box again a short while after; if so just repeat
the previous step a few times and it should work.</p></li>
<li><p>This will put the module back to 9600 baud. Set your X-CTU PC
settings to that and test it. It should report back that it’s
recognized.</p></li>
<li><p>Once you’ve confirmed that it’s working again, make you sure you
reset its baud rate (typically 57k for APM) and VID number to match
your other module.</p></li>
</ol>
<p>(Thanks to Doug Barnett for these tips)</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>