<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PX4FLOW Optical Flow Camera Board &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PX4FLOW Optical Flow Camera Board</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="px4flow-optical-flow-camera-board">
<span id="common-px4flow-overview"></span><h1>PX4FLOW Optical Flow Camera Board<a class="headerlink" href="#px4flow-optical-flow-camera-board" title="Permalink to this heading">¶</a></h1>
<p>[copywiki destination=”copter,plane,rover”]</p>
<p>This article describes how to setup the PX4FLOW (Optical Flow) Sensor which can be used for <a class="reference internal" href="common-non-gps-navigation-landing-page.html#common-non-gps-navigation-landing-page"><span class="std std-ref">Non-GPS navigation</span></a>.</p>
<div class="video_wrapper" style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/LP8kl4hGfMw" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The PX4FLOW is not yet supported in Plane or Rover.</p>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The PX4FLOW (Optical Flow) Sensor is a
specialized high resolution downward pointing camera module and a 3-axis gyro that uses
the ground texture and visible features to determine aircraft ground velocity.
Although the sensor may be supplied with a built-in Maxbotix LZ-EZ4 sonar to measure
height, this has not been reliable enough over a range of surfaces in testing, so its
readings are not used. It is recommended to purchase a PX4Flow device without the sonar.
Instead a separate <a class="reference internal" href="common-rangefinder-landingpage.html#common-rangefinder-landingpage"><span class="std std-ref">Range Finder</span></a>
such as the <a class="reference internal" href="common-lightware-sf10-lidar.html#common-lightware-sf10-lidar"><span class="std std-ref">LightWare SF10b</span></a>
should also be attached to the vehicle.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To use this flow sensor you will need to purchase a separate range
finder like the <a class="reference internal" href="common-lightware-sf10-lidar.html#common-lightware-sf10-lidar"><span class="std std-ref">LightWare SF10b</span></a></p>
</div>
</section>
<section id="where-to-buy">
<h2>Where to Buy<a class="headerlink" href="#where-to-buy" title="Permalink to this heading">¶</a></h2>
<p>This sensor is available from numerous retailers including:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://store.cuav.net/shop/flow-sensor/">CUAV PX4Flow</a></p></li>
<li><p><a class="reference external" href="https://shop.holybro.com/px4flow-kit_p1035.html">Holybro PX4Flow</a></p></li>
</ul>
</section>
<section id="install-drivers-windows-only">
<h2>Install Drivers (Windows only)<a class="headerlink" href="#install-drivers-windows-only" title="Permalink to this heading">¶</a></h2>
<p>On a Windows machine a “PX4Flow” device should appear in Connection drop-down of the Mission Planner (and the Windows Device Manager), or be automatically recognized by QGroundControl.  If it does not you may need to download, unzip and manually install the <a class="reference external" href="https://download.ardupilot.org/downloads/wiki/advanced_user_tools/px4flow_win_driver.zip">px4flow windows driver</a> which may in turn require allowing installing unsigned drivers.</p>
</section>
<section id="using-missionplanner">
<h2>Using MissionPlanner<a class="headerlink" href="#using-missionplanner" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Download and unzip the <a class="reference external" href="https://download.ardupilot.org/downloads/wiki/advanced_user_tools/px4flow-klt-06Dec2014.zip">PX4Flow-KLT firmware</a>
(<a class="reference external" href="https://github.com/priseborough/px4flow/tree/klt_flow">source code here</a>)</p></li>
<li><p>Connect the PX4Flow sensor to your computer using a micro USB cable.</p></li>
<li><p>Open the Initial Setup, Install Firmware screen, select the COM port and click the “Load custom firmware” link.  Select the px4flow-klt-06dec2014.px4 binary you downloaded in Step 1.  You may need to unplug and plug back in the sensor to start the upload.</p>
<a class="reference external image-reference" href="../_images/PX4Flow_FirmUpgrade1_MP.png"><img alt="../_images/PX4Flow_FirmUpgrade1_MP.png" src="../_images/PX4Flow_FirmUpgrade1_MP.png" /></a>
</li>
<li><p>Disconnect and reconnect the sensor/USB cable</p></li>
<li><p>Select the appropriate COM port and press Connect</p></li>
<li><p>Open the Initial Setup &gt; Optional Hardware &gt; PX4Flow screen</p></li>
<li><p>Remove the lens cap and point the camera at a high contrast object at least 3m away.  Remove the small screw that stops the lens from turning and adjust the focus until the image appears clearly</p>
<a class="reference external image-reference" href="../_images/PX4Flow_Focus_MP.png"><img alt="../_images/PX4Flow_Focus_MP.png" src="../_images/PX4Flow_Focus_MP.png" /></a>
</li>
</ol>
</section>
<section id="using-qgroundcontrol">
<h2>Using QGroundControl<a class="headerlink" href="#using-qgroundcontrol" title="Permalink to this heading">¶</a></h2>
<p>In order to use QgroundControl, PX4Flow and ArduPilot, you will need to complete setup and focussing with the firmware loaded by QGroundControl, and then update the firmware to be compatible with ArduPilot.</p>
<ol class="arabic simple">
<li><p>Select the Vehicle Setup page, and click the Firmware tab.</p></li>
<li><p>Connect the PX4Flow sensor to your computer using a micro USB cable.</p></li>
<li><p>Check the “Standard Version (stable)” is selected in the right hand pane. Click “OK”. QGroundControl will flash a firmware that can be used to focus the lens.</p></li>
<li><p>Unplug and replug the sensor. Two extra tabs should appear: “PX4Flow” and “Parameters”.</p></li>
<li><p>Click “PX4Flow”, remove the lens cap and point the camera at a high contrast object at least 3m away.  Remove the small screw that stops the lens from turning and adjust the focus until the image appears clearly.  This will focus the device to infinity.  Refit the screw.</p></li>
<li><p>Download and unzip the <a class="reference external" href="https://download.ardupilot.org/downloads/wiki/advanced_user_tools/px4flow-klt-06Dec2014.zip">PX4Flow-KLT firmware</a>
(<a class="reference external" href="https://github.com/priseborough/px4flow/tree/klt_flow">source code here</a>)</p></li>
<li><p>Unplug the sensor, click on the “Firmware” tab and replug the sensor.</p></li>
<li><p>On the right hand side, click on the firmware version dropdown, and select “Custom firmware file”.  Click “OK”.  Then select the firmware downloaded above.  QGroundControl should now flash a firmware compatible with ArduPilot.  QGroundControl will now think that the sensor is a Pixhawk.  Dont worry.  Unplug it, and connect it to your autopilot.</p></li>
</ol>
</section>
<section id="connect-to-the-pixhawk">
<h2>Connect to the Pixhawk<a class="headerlink" href="#connect-to-the-pixhawk" title="Permalink to this heading">¶</a></h2>
<a class="reference external image-reference" href="../_images/OptFlow_Pixhawk.jpg"><img alt="../_images/OptFlow_Pixhawk.jpg" src="../_images/OptFlow_Pixhawk.jpg" /></a>
<p>The sensor should be connected to the autopilot via the 4-pin I2C port.  In
most cases an I2C splitter should be used to allow other I2C devices (like the external RGB LED and
GPS/Compass module’s compass) to share the same port.</p>
</section>
<section id="mounting-to-the-frame">
<h2>Mounting to the Frame<a class="headerlink" href="#mounting-to-the-frame" title="Permalink to this heading">¶</a></h2>
<p>The default mounting of the flow sensor is for it to be pointing straight down with the micro USB port pointing towards the front of the vehicle.
On the back of the sensor you should see the axis printed, the X axis should point forwards and the Y axis to the right.
The <a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#flow-orient-yaw" title="(in Copter)"><span class="xref std std-ref">FLOW_ORIENT_YAW</span></a> parameter can be used to account for other yaw orientations.</p>
<p>It is important that the flow sensor be mounted where it does not experience
angular vibration that could blur the image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default mounting orientation is different to that shown on
the <a class="reference external" href="https://docs.px4.io/master/en/sensor/px4flow.html">PX4FLOW wiki</a>. If you
mount the board as shown in the <a class="reference external" href="https://docs.px4.io/master/en/sensor/px4flow.html">PX4FLOW wiki</a>, you will need to set
<a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#flow-orient-yaw" title="(in Copter)"><span class="xref std std-ref">FLOW_ORIENT_YAW</span></a> to -9000.</p>
</div>
</section>
<section id="enabling-the-sensor">
<h2>Enabling the sensor<a class="headerlink" href="#enabling-the-sensor" title="Permalink to this heading">¶</a></h2>
<a class="reference external image-reference" href="../_images/OptFlow_MPSetup.png"><img alt="../_images/OptFlow_MPSetup.png" src="../_images/OptFlow_MPSetup.png" /></a>
<p>The sensor can be enabled by connecting to the autopilot with the Mission Planner and
then on the <strong>Initial Setup | Optional Hardware | Optical Flow</strong> page
check the <strong>Enable</strong> checkbox.  Alternatively the <a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#flow-type" title="(in Copter)"><span class="xref std std-ref">FLOW_TYPE</span></a>
parameter should be set to “1” through the full parameters list.  The
sensor will be initialised once the Pixhawk board is rebooted.</p>
<p>If the sensor is reported to be unhealthy, it may help to set <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#brd-boot-delay" title="(in Rover)"><span class="xref std std-ref">BRD_BOOT_DELAY</span></a> to 600 (0.6 seconds) and reboot the autopilot.  This will give more time for the sensor to start-up before the autopilot probes for it on the I2C bus.</p>
</section>
<section id="testing-and-setup">
<h2>Testing and Setup<a class="headerlink" href="#testing-and-setup" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://ardupilot.org/rover/docs/common-optical-flow-sensor-setup.html#common-optical-flow-sensor-setup" title="(in Rover)"><span>Optical Flow Sensor Testing and Setup</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>