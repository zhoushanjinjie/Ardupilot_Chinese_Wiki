<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>连接Mission Planner和飞控 &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mandatory Hardware Configuration" href="configuring-hardware.html" />
    <link rel="prev" title="Loading Firmware onto boards without existing ArduPilot firmware" href="common-loading-firmware-onto-chibios-only-boards.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="initial-setup.html">首次设置</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common-install-gcs.html">安装地面站软件</a></li>
<li class="toctree-l2"><a class="reference internal" href="autopilot-assembly-instructions.html">飞控系统安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-loading-firmware-onto-pixhawk.html">将固件加载到有ArduPilot固件的板子</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-loading-firmware-onto-chibios-only-boards.html">将固件加载到没有ArduPilot固件的板子</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">连接Mission Planner和飞控</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-connection">Setting up the connection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connecting-to-multiple-vehicles">Connecting to multiple vehicles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-composite-connections">Troubleshooting Composite Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-topics">Related topics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-hardware.html">配置</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional-information.html">附加信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="initial-setup.html">首次设置</a></li>
      <li class="breadcrumb-item active">连接Mission Planner和飞控</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="connect-mission-planner-to-autopilot">
<span id="common-connect-mission-planner-autopilot"></span><h1>连接Mission Planner和飞控<a class="headerlink" href="#connect-mission-planner-to-autopilot" title="Permalink to this heading">¶</a></h1>
<p>This article explains how to connect <em>Mission Planner</em> to an autopilot
in order to receive telemetry and control the vehicle.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are separate instructions for connecting in order to <a class="reference internal" href="common-loading-firmware-onto-pixhawk.html#common-loading-firmware-onto-pixhawk"><span class="std std-ref">Load Firmware</span></a> for existing ArduPilot firmware installations, or for boards <a class="reference internal" href="common-loading-firmware-onto-chibios-only-boards.html#common-loading-firmware-onto-chibios-only-boards"><span class="std std-ref">without existing ArduPilot firmware</span></a>.</p>
</div>
<section id="setting-up-the-connection">
<h2>Setting up the connection<a class="headerlink" href="#setting-up-the-connection" title="Permalink to this heading">¶</a></h2>
<p>To establish a connection you must first choose the communication
method/channel you want to use, and then set up the physical hardware
and Windows device drivers. You can connect the PC and autopilot using
USB cables, <a class="reference external" href="https://ardupilot.org/copter/docs/common-telemetry-landingpage.html#common-telemetry-landingpage" title="(in Copter)"><span class="xref std std-ref">Telemetry Radios</span></a>,
<a class="reference internal" href="common-mission-planner-bluetooth-connectivity.html#common-mission-planner-bluetooth-connectivity-detailed-connecting-with-mission-planner"><span class="std std-ref">Bluetooth</span></a>,
IP connections etc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The driver for your connection hardware must be present on Windows
as this makes your connection’s COM port and default data rate available
to <em>Mission Planner</em>.</p>
</div>
<figure class="align-default" id="id2">
<a class="reference external image-reference" href="../_images/pixhawk_usb_connection.jpg"><img alt="../_images/pixhawk_usb_connection.jpg" src="../_images/pixhawk_usb_connection.jpg" style="width: 450px;" /></a>
<figcaption>
<p><span class="caption-text">Pixhawk USB Connection</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id3">
<a class="reference external image-reference" href="../_images/new-radio-laptop.jpg"><img alt="../_images/new-radio-laptop.jpg" src="../_images/new-radio-laptop.jpg" style="width: 450px;" /></a>
<figcaption>
<p><span class="caption-text">Connection using SiK Radio</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>On <em>Mission Planner</em>, the connection and data rate are set up using the
drop down boxes in the upper right portion of the screen.</p>
<a class="reference external image-reference" href="../_images/MisionPlanner_ConnectButton.png"><img alt="../_images/MisionPlanner_ConnectButton.png" src="../_images/MisionPlanner_ConnectButton.png" /></a>
<p>Once you’ve attached the USB or Telemetry Radio, Windows will
automatically assign your autopilot a COM port number, and that will
show in the drop-down menu (the actual number does not matter). The
appropriate data rate for the connection is also set (typically the USB
connection data rate is 115200 and the radio connection rate is 57600).</p>
<p>Select the desired port and data rate and then press the <strong>CONNECT</strong>
button to connect to the autopilot. After connecting <strong>Mission Planner</strong>
will download parameters from the autopilot and the button will change
to <strong>DISCONNECT</strong> as shown:</p>
<a class="reference external image-reference" href="../_images/MisionPlanner_DisconnectButton.png"><img alt="../_images/MisionPlanner_DisconnectButton.png" src="../_images/MisionPlanner_DisconnectButton.png" /></a>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The “select port” dropdown also contains TCP or UDP port options
that can be used to connect to an autopilot over a network.</p>
</div>
<p>The “Stats…” hotlink beneath the port selection box, if clicked, will give information about the connection, such as if <a class="reference internal" href="common-MAVLink2-signing.html#common-mavlink2-signing"><span class="std std-ref">Signing security</span></a> is active, link stats, etc. Sometimes this window pops up beneath the current screen and will have to be brought to the front to be seen.</p>
<a class="reference external image-reference" href="../_images/MP-stats.png"><img alt="../_images/MP-stats.png" src="../_images/MP-stats.png" /></a>
<section id="connecting-to-multiple-vehicles">
<h3>Connecting to multiple vehicles<a class="headerlink" href="#connecting-to-multiple-vehicles" title="Permalink to this heading">¶</a></h3>
<p>Additional connections can be made by right-clicking the <strong>CONNECT</strong> button and selecting <strong>Connection Options</strong> from the drop-down list.</p>
<a class="reference external image-reference" href="../_images/MP-connect-rightclick-menu.png"><img alt="../_images/MP-connect-rightclick-menu.png" src="../_images/MP-connect-rightclick-menu.png" /></a>
<p>A file with a pre-written list of connections can be loaded with the <strong>Connection List</strong> drop-down option. This is an example format of the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5670</span>
<span class="n">udp</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">14550</span>
<span class="n">udpcl</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.255</span><span class="p">:</span><span class="mi">14550</span>
<span class="n">serial</span><span class="p">:</span><span class="n">com4</span><span class="p">:</span><span class="mi">115200</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h2>
<p>If Mission Planner is unable to connect:</p>
<ul class="simple">
<li><p>Check that the correct baud rate is used for the selected method
(115200 on USB or 57600 on Radio/Telemetry)</p></li>
<li><p>If attaching via USB, be sure that a few seconds after power up have passed before attempting to connect. If you attempted to connect during the bootloader initialization time, Windows may get the wrong USB information. Connection attempts after this may require that the USB connection be  unplugged and re-plugged,then wait for bootloader to enter the main code ( few seconds), then attempt the connection. Occasionally, MP must be restarted if an attempt to connect is made while in the bootloader initialization period.</p></li>
<li><p>If using a COM port on Windows, check that the connection’s COM port
exists in the Windows Device Manager’s list of serial ports.</p></li>
<li><p>If your autopilot has an F7 or H7 processor and has CAN ports, then see the section below, <a class="reference internal" href="#troubleshooting-composite-connections"><span class="std std-ref">Troubleshooting Composite Connections</span></a></p></li>
<li><p>If using a USB port, try a different physical USB port</p></li>
<li><p>If using a UDP or TCP connection, check that your firewall is not blocking IP traffic</p></li>
</ul>
<p>You should also ensure that the autopilot controller board has
appropriate ArduPilot firmware installed and has booted correctly (on
Pixhawk there are useful <a class="reference internal" href="common-leds-pixhawk.html#common-leds-pixhawk"><span class="std std-ref">LEDs</span></a> and
<a class="reference internal" href="common-sounds-pixhawkpx4.html#common-sounds-pixhawkpx4"><span class="std std-ref">Sounds</span></a> which can tell you the state of the autopilot).</p>
<p>If using a remote link (not USB) and Mission Planner connects, but does not download parameters or you cannot get commands, like mode changes acted upon,then the autopilot probably has Signing turned on. See <a class="reference internal" href="common-MAVLink2-signing.html#common-mavlink2-signing"><span class="std std-ref">[copywiki destination=”plane,copter,rover,blimp,planner”]</span></a>.</p>
</section>
<section id="troubleshooting-composite-connections">
<span id="id1"></span><h2>Troubleshooting Composite Connections<a class="headerlink" href="#troubleshooting-composite-connections" title="Permalink to this heading">¶</a></h2>
<p>Autopilots with F7 or H7 processors and having CAN interfaces use firmware that presents two USB interfaces: One for the normal MAVLink connection, and one for SLCAN serial connections to the CAN interface for configuration and firmware updates.This is called a composite USB device.</p>
<p>By default, the MAVLink USB interface is SERIAL0 and the SLCAN USB interface is the highest SERIALx port the board presents. The Windows driver currently installed with Mission Planner may select to use either one, and since both are set by default in ArduPilot firmware for MAVLINK protocol, it will work fine, whichever one it chooses as the COM port.</p>
<p>However, there is a situation where the user will find that it will not connect to the obvious COM port in the Mission Planner dropdown box.This occurs when the user accidentally changes the protocol of whichever SERIALx port the Windows driver is using as the MAVLink COM port to something other than MAVLink. This can easily happen if the user takes an existing parameter file from a vehicle configuration used with a different autopilot that has the protocol changed. For example, the user has a plane with non F7/H7 CAN capable autopilot and upgrades it to one that is, then loads his existing parameter file while setting up the plane with the new autopilot. As soon as the parameter file is loaded and the autopilot is rebooted, communication is lost and cannot be re-established.</p>
<p>What has occurred, is that the protocol for the SERIALx port that Windows was using has been changed. Almost always, this is the highest numbered SERIALx port since that is commonly set to -1 on non-CAN capable autopilots, and the Windows COM port driver has selected this interface as the COM port instead of SERIAL0.</p>
<p>The procedure to recover is as follows:</p>
<ul class="simple" id="loading-composite-usb">
<li><p>Go to Windows Device Manager and find the COM port being used by the autopilot in the Ports listings. It will have the COM Port # you used to connect initially to Mission Planner. Right click and it will present “Update driver software” as one of the options. Click it.</p></li>
</ul>
<img alt="../_images/devicemanager.png" src="../_images/devicemanager.png" />
<ul class="simple">
<li><p>Click the “Browse my computer……” option and then click the “Choose from a list…” option and you will see this screen:</p></li>
</ul>
<img alt="../_images/composite-driver.png" src="../_images/composite-driver.png" />
<ul class="simple">
<li><p>Scroll down the top list until “Composite USB” option appears and click it.</p></li>
<li><p>Now reconnect your autopilot to the PC and two COM ports will be presented. One will connect (the remaining one with MAVLink Protocol) and the other will not. If you do not connect to one, try the other. But DO NOT disconnect the autopilot from the PC or the composite driver will unload and you will have to start over.</p></li>
<li><p>Now that you are connected to Mission Planner, change back the protocol of the Serialx port protocol to 2 (MAVLink2). You can now disconnect and reconnect the autopilot and it will present only one COM port and you should be able to connect from now on. Do not change this protocol from now on unless trying to utilize the SLCAN interface. It may be a bit unfamiliar since the Mission Planner SERIALx port being used is no longer the normal SERIAL0 but rather,the highest port, but this does not affect anything in the autopilot’s configuration and operation.</p></li>
</ul>
</section>
<section id="related-topics">
<h2>Related topics<a class="headerlink" href="#related-topics" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="common-mission-planner-bluetooth-connectivity.html#common-mission-planner-bluetooth-connectivity-detailed-connecting-with-mission-planner"><span class="std std-ref">Mission Planner Bluetooth Connectivity</span></a></p>
<p>[copywiki destination=”plane,copter,rover,planner,blimp”]</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common-loading-firmware-onto-chibios-only-boards.html" class="btn btn-neutral float-left" title="Loading Firmware onto boards without existing ArduPilot firmware" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuring-hardware.html" class="btn btn-neutral float-right" title="Mandatory Hardware Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>