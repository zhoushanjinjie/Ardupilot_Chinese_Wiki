<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OEM Customization &mdash; Copter  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/./useralerts.js"></script>
        <script data-domain="ardupilot.org" defer="defer" src="https://plausible.ardupilot.org/js/script.outbound-links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Use-Cases and Applications" href="common-use-cases-and-applications.html" />
    <link rel="prev" title="SkyRocket Software" href="skyrocket-software.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Copter
              <img src="../_static/ardupilot_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="copter-introduction.html">Copter简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">选择飞控</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-GCS.html">地面站软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">首次设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">首次飞行和调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">传统直升机</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">任务规划</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">如果出现问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-advanced-configuration.html">高级配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">可选硬件</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="additional-information.html">附加信息</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common-master-features.html">Upcoming Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-antenna-tracking.html">Antenna Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-simulation.html">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="solo_arducopter_upgrade.html">Solo Software Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="skyrocket.html">SkyRocket</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OEM Customization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#customization-steps">Customization Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alternative-to-customizing-hwdef-dat">Alternative To Customizing hwdef.dat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="common-use-cases-and-applications.html">Use Cases and Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-appendix.html">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">用户警报</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Copter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="additional-information.html">Additional Information and Topics of Interest</a></li>
      <li class="breadcrumb-item active">OEM Customization</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="oem-customization">
<span id="common-oem-customization"></span><h1>OEM Customization<a class="headerlink" href="#oem-customization" title="Permalink to this heading">¶</a></h1>
<p>ArduPilot provides several ways for an OEM to provide firmware on their products that has been customized to their specific system configuration:</p>
<ul class="simple">
<li><p>Ability to have specific defaults for parameters to match included system components, such as gimbals, or entire systems’ peripherals, such as in ready-to-fly vehicles. This allows the user to “reset to defaults” using Mission Planner or MAVProxy in case of a problem with parameters having been accidentally changed, and only have to re-calibrate compass/IMU/and RC, at most, to be ready to fly.</p></li>
<li><p>Ability to provide Lua scripts in ROM for special functions without the end-user having to load them on the SD card. Read more about Lua scripting in ArduPilot <a class="reference internal" href="common-lua-scripts.html#common-lua-scripts"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Ability to change the firmware string displayed to the user.</p></li>
<li><p>Ability to include pictures and informational files in available free flash space.</p></li>
<li><p>Ability to change parameters and mark them as read-only so that users cannot change them using <a class="reference external" href="https://ardupilot.org/dev/docs/apjtools-intro.html#apjtools-intro" title="(in Dev)"><span class="xref std std-ref">APJ Tools</span></a>.</p></li>
</ul>
<section id="customization-steps">
<h2>Customization Steps<a class="headerlink" href="#customization-steps" title="Permalink to this heading">¶</a></h2>
<p>This section assumes that the OEM has set up the build environment (<a class="reference external" href="https://ardupilot.org/dev/docs/building-the-code.html#building-the-code" title="(in Dev)"><span>Building the code</span></a>) and cloned the ArduPilot GitHub repo locally (<a class="reference external" href="https://ardupilot.org/dev/docs/where-to-get-the-code.html#where-to-get-the-code" title="(in Dev)"><span>Downloading the Code / Using Git</span></a>), to build its customized version of the firmware.</p>
<ol class="arabic">
<li><p>Create a branch with the version of firmware you wish to base the customization upon. This will usually be the current stable version. To do this for ArduPlane Stable, for example, assuming you are already in the ArduPilot directory on your PC:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>fetch<span class="w"> </span>https://github.com/ArduPilot/ardupilot.git<span class="w"> </span>&lt;version&gt;
<span class="w">                    </span>where<span class="w"> </span>&lt;version&gt;<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>tag<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>stable<span class="w"> </span>version<span class="w"> </span><span class="k">for</span><span class="w"> </span>the
<span class="w">                    </span>desired<span class="w"> </span>vehicle:<span class="w"> </span>ArduPlane-stable,<span class="w"> </span>ArduCopter-stable,
<span class="w">                    </span>APMrover2-stable,etc.

git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>&lt;your<span class="w"> </span>branch<span class="w"> </span>name&gt;<span class="w"> </span>FETCH_HEAD
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">libraries/AP_HAL_ChibiOS/hwdef</span></code> directory, create a new subdirectory for your customized board definitions. In this example, the directory will be named <code class="docutils literal notranslate"><span class="pre">OEM_CubeOrange</span></code> to create a derivative for that board.</p></li>
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">hwdef.dat</span></code> file in this format. In this case, our ready-to-fly plane will be using a CubeOrange autopilot and only requires a single line:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span> <span class="o">../</span><span class="n">CubeOrange</span><span class="o">/</span><span class="n">hwdef</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>The firmware name can be customized by adding one line to the <code class="docutils literal notranslate"><span class="pre">hwdef.dat</span></code> file.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">define</span> <span class="n">AP_CUSTOM_FIRMWARE_STRING</span> <span class="s2">&quot;MyMagicFrame&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Custom frame type strings can be created through Lua the scripting method <code class="docutils literal notranslate"><span class="pre">motors:set_frame_string(&quot;Custom</span> <span class="pre">frame</span> <span class="pre">name&quot;)</span></code>.</p>
</div>
</div></blockquote>
</li>
<li><p>Now in that same directory, copy the base board’s <code class="docutils literal notranslate"><span class="pre">hwdef_bl.dat</span></code> bootloader file, and then include a file named <code class="docutils literal notranslate"><span class="pre">defaults.parm</span></code>. This file will be the parameter overrides of the standard defaults to match your system’s configuration. Things like output function assignments, auxiliary RC switches, flight and tuning parameters, etc.</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">defaults.parm</span></code> file should be as small as possible. Some boards only allow 1024 bytes total for this file. Every ASCII byte in the file counts against this limit (except for comment lines). Use integer values where possible. Below is a simple example. Serial port protcols,baud rate,and options defaultscan be set directly in the hwdef, as well as NTF_LED_TYPES, and battery monitor defaults, and should be done there instead of a defaults file.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup for NTF LEDs on output5</span>
<span class="n">SERVO5_FUNCTION</span> <span class="mi">120</span>
<span class="n">NTF_LED_TYPES</span> <span class="mi">256</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>You can also embed <a class="reference internal" href="common-lua-scripts.html#common-lua-scripts"><span class="std std-ref">Lua scripts</span></a> in the ROM of the chip that will automatically run. Since Lua is currently only run on autopilots with a lot of flash space, they are only restricted in total aggregate size to available free flash memory. Put the scripts in a sub-directory called <code class="docutils literal notranslate"><span class="pre">scripts</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">libraries/AP_HAL_ChibiOS/hwdef/OEM_CubeOrange/scripts</span></code>. Files must end in <code class="docutils literal notranslate"><span class="pre">.lua</span></code>.</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The user may also run Lua scripts off the SD card, so care should be taken in naming the embedded script file names to not conflict with potential user file names. It is recommended that the file names of embedded Lua scripts be provided in the product documentation for the user.</p>
</div>
</div></blockquote>
</li>
<li><p>You can also imbed small pieces of documentation in the ROM of the chip that are readable when examining the &#64;ROMFS folder via MAVFtp. These can be pictures or small informational documents. These must fit within the free flash space of the autopilot. These files can be located in sub-directories in <code class="docutils literal notranslate"><span class="pre">libraries/AP_HAL_ChibiOS/hwdef/OEM_CubeOrange</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">libraries/AP_HAL_ChibiOS/hwdef/OEM_CubeOrange/AircraftManual</span></code>).</p></li>
<li><p>Now build as normal with OEM-CubeOrange as the board name in the configuration. The default parameters, Lua scripts, and the custom firmware name will be embedded appropriately.</p></li>
</ol>
<section id="alternative-to-customizing-hwdef-dat">
<h3>Alternative To Customizing hwdef.dat<a class="headerlink" href="#alternative-to-customizing-hwdef-dat" title="Permalink to this heading">¶</a></h3>
<p>Instead of creating a separate branch and modifying the hwdef file, you can also insert Lua scripts or even informational files into the ROMFS of the build. Simply go to the local ardupilot repository’s “build” folder and create a sub-folder named “ROMFS_custom”. Place your LUA scripts in a sub-folder in this directory, named “scripts” (i.e. the path <code class="docutils literal notranslate"><span class="pre">ardupilot/build/ROMFS_custom/scripts</span></code>). You can have other sub-folders for informational files and these will be included and viewable when examining the &#64;ROMFS folder with MAVFtp.</p>
<p>[copywiki destination=”plane,copter,rover,dev”]</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="skyrocket-software.html" class="btn btn-neutral float-left" title="SkyRocket Software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="common-use-cases-and-applications.html" class="btn btn-neutral float-right" title="Use-Cases and Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ArduPilot Dev Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>